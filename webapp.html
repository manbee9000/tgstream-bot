<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Stream Viewer</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }

    #player {
      width: 100%;
      height: 100%;
      border: none;
    }

    #error {
      color: white;
      text-align: center;
      margin-top: 40vh;
      font-size: 22px;
      display: none;
    }
  </style>
</head>
<body>

  <iframe id="player"></iframe>
  <div id="error">⚠️ Не удалось загрузить видео</div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const params = new URLSearchParams(window.location.search);
    const src = params.get("src");

    const iframe = document.getElementById("player");
    const errorEl = document.getElementById("error");

    if (!src) {
      errorEl.style.display = "block";
      errorEl.innerText = "Нет ссылки на стрим";
    } 
    else if (src.includes("youtube.com") || src.includes("youtu.be")) {

      // YouTube embed
      let embed = src;

      if (src.includes("watch?v=")) {
        embed = src.replace("watch?v=", "embed/");
      } 
      else if (src.includes("youtu.be/")) {
        embed = src.replace("youtu.be/", "www.youtube.com/embed/");
      }

      iframe.src = embed;

    }
    else if (src.includes("twitch.tv")) {
      // Twitch embed-player
      const channel = src.split("twitch.tv/")[1];
      const parent = window.location.hostname;

      iframe.src =
        `https://player.twitch.tv/?channel=${channel}&parent=${parent}&muted=false`;

    }
    else if (src.includes("kick.com")) {
      // Kick embed
      const channel = src.split("kick.com/")[1];
      iframe.src = `https://player.kick.com/${channel}`;

    }
    else if (src.includes("trovo.live")) {
      // Trovo embed
      const channel = src.split("trovo.live/")[1];
      iframe.src = `https://player.trovo.live/embed/player?streamername=${channel}`;

    }
    else {
      // fallback
      iframe.src = src;
    }
  </script>
</body>
</html>
